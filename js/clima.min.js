/*
 Clima v0.1 Copyright (C) Noah Pitts 2017
 Distributed under the GNU General Public License v3.0 (license terms are at https://choosealicense.com/licenses/gpl-3.0).
 */
var clima=clima||{};clima.chart=clima.chart||{},clima.chart.heatmap=clima.chart.heatmap||{},clima.charts=clima.charts||[],clima.chart.heatmap.name="Heatmap",clima.chart.heatmap.create=function(e){return new Heatmap(e)},clima.charts.push(clima.chart.heatmap);class Heatmap{constructor(e){this.name="Heatmap",this.board={},this.boardWidth=1250,this.boardHeight=320,this.boardTopMargin=60,this.boardBottomMargin=60,this.boardLeftMargin=60,this.boardRightMargin=110,this.graphicWidth=this.boardWidth-this.boardLeftMargin-this.boardRightMargin,this.graphicHeight=this.boardHeight-this.boardTopMargin-this.boardBottomMargin,this.data=e,this.field=clima.utils.getField("DryBulbTemp"),this.colorHigh="#ffff00",this.colorLow="#0000ff",this.title=this.name+" of "+this.field.name}drawChart(e){e.selectAll("svg").remove(),this.board.svg=e.append("svg").attr("class","board").attr("width",this.boardWidth).attr("height",this.boardHeight).attr("viewBox","0 0 "+this.boardWidth+" "+this.boardHeight).attr("preserveAspectRatio","xMidYMid meet"),this.board.pixels=this.board.svg.append("g").attr("class","heatmap-pixels").attr("transform","translate("+this.boardLeftMargin+","+this.boardTopMargin+")"),this.drawPixels(),this.board.xAxis=this.board.svg.append("g").attr("class","heatmap-xAxis").attr("transform","translate("+this.boardLeftMargin+","+(1.04*this.graphicHeight+this.boardTopMargin)+")"),this.drawXAxis(),this.board.yAxis=this.board.svg.append("g").attr("class","heatmap-yAxis").attr("transform","translate("+(this.boardLeftMargin-8)+","+this.boardTopMargin+")"),this.drawYAxis(),this.board.legend=this.board.svg.append("g").attr("class","heatmap-legend").attr("transform","translate("+(this.boardLeftMargin+this.graphicWidth)+","+this.boardTopMargin+")"),this.drawLegend(),this.board.title=this.board.svg.append("g").attr("class","heatmap-title"),this.drawTitle()}drawPixels(){var e=function(M){return M.dayOfYear()},r=d3.scaleLinear().domain([0,364]).range([0,this.graphicWidth]),o=function(M){return r(e(M))},l=function(M){return M.hourOfDay()},c=d3.scaleLinear().domain([23,0]).range([0,this.graphicHeight]),u=function(M){return c(l(M))},y=this.field.key,T=function(M){return M.valueOf(y)},v=d3.scaleLinear().domain(this.data.metaOf(y).domain).range([d3.rgb(this.colorLow),d3.rgb(this.colorHigh)]),w=function(M){return v(T(M))},O=this.field.units,k=function(M){let D=T(M)+" "+O;return D};this.board.pixels.selectAll("rect").data(this.data.ticks).enter().append("rect").attr("class","heatmap-pixel").attr("x",function(M){return o(M)}).attr("y",function(M){return u(M)}).attr("width",this.graphicWidth/364).attr("height",this.graphicHeight/23).attr("transform","translate("+-0.5*(this.graphicWidth/365)+","+-0.5*(this.graphicHeight/24)+")").attr("fill",function(M){return w(M)}).append("svg:title").text(function(M){return k(M)})}drawXAxis(){var e=d3.scaleTime().domain([new Date(clima.utils.datetime.year,0,1),new Date(clima.utils.datetime.year,11,31)]).range([0,this.graphicWidth]),r=d3.axisBottom().scale(e).ticks(d3.timeMonth).tickSize(16,0).tickFormat(d3.timeFormat("%b"));this.board.xAxis.call(r),this.board.xAxis.selectAll("text").attr("transform","translate("+this.graphicWidth/24+", -10)"),this.board.xAxis.append("text").attr("x",this.graphicWidth/2).attr("y",40).text("Month of the Year").attr("text-anchor","middle").attr("font-family","sans-serif").attr("font-size","14px").attr("fill","black")}drawYAxis(){var e=d3.scaleLinear().domain([23,0]).range([0,this.graphicHeight]),r=d3.axisLeft().scale(e).tickValues([0,6,12,18,23]);this.board.yAxis.call(r),this.board.yAxis.append("text").attr("x",-30).attr("y",this.graphicHeight/2).text("Hour of the Day").attr("text-anchor","middle").attr("transform","rotate(-90, -30, "+this.graphicHeight/2+")").attr("font-family","sans-serif").attr("font-size","14px").attr("fill","black")}drawLegend(){for(var e=this.boardRightMargin/5,r=this.boardRightMargin/3,o=this.data.metaOf(this.field.key),l=[],c=0;24>c;c++)l.push(c);var u=d3.scaleLinear().domain([0,23]).range([0,this.graphicHeight]),y=function(k,M){return u(M)},T=d3.scaleLinear().domain([23,0]).range([d3.rgb(this.colorLow),d3.rgb(this.colorHigh)]),v=function(k,M){return T(k,M)};this.board.legend.rect=this.board.legend.append("g").attr("transform","translate("+e+","+-0.5*(this.graphicHeight/24)+")"),this.board.legend.rect.selectAll("rect").data(l).enter().append("rect").attr("x",0).attr("y",function(k,M){return y(k,M)}).attr("width",r).attr("height",this.graphicHeight/24).attr("fill",function(k){return v(k)});var w=d3.scaleLinear().domain([o.max,o.min]).range([0,this.graphicHeight]),O=d3.axisRight().scale(w).ticks(4,".0f");this.board.legend.axis=this.board.legend.append("g").attr("transform","translate("+(e+r+6)+",0)"),this.board.legend.axis.call(O),this.board.legend.append("text").attr("x",100).attr("y",this.graphicHeight/2).text(this.field.name+" ("+this.field.units+")").attr("text-anchor","middle").attr("transform","rotate(90, 100, "+this.graphicHeight/2+")").attr("font-family","sans-serif").attr("font-size","14px").attr("fill","black")}drawTitle(){this.board.title.selectAll("text").remove(),this.board.title.append("text").attr("x",this.boardWidth/2).attr("y",this.boardTopMargin/2).text(this.title).attr("text-anchor","middle").attr("font-family","sans-serif").attr("font-size","24px").attr("fill","black")}drawTitleControl(e){var r=e.append("div").attr("class","row container control-box");r.append("div").attr("class","row").append("h5").attr("class","container").text("Chart Title");var o=r.append("div").attr("class","input-group mb-3");o.append("input").attr("type","text").attr("class","form-control").attr("id","chartTitle").attr("placeholder",this.title);var l=o.append("div").attr("class","input-group-append");l.append("button").attr("class","btn btn-outline-secondary").attr("type","button").attr("id","button-applyTitle").text("Apply"),l.append("button").attr("class","btn btn-outline-secondary").attr("type","button").attr("id","button-resetTitle").text("Reset"),$(document).ready(function(){$("#button-applyTitle").click(clima.editor.chart.applyTitle),$("#button-resetTitle").click(clima.editor.chart.resetTitle)})}applyTitle(){clima.editor.chart.title=$("#chartTitle").val(),clima.editor.chart.drawChart(clima.editor.editorViewport)}resetTitle(){clima.editor.chart.title=clima.editor.chart.name+" of "+clima.editor.chart.field.name+" in "+clima.editor.chart.data.location.city,$("#chartTitle").val(clima.editor.chart.title),clima.editor.chart.drawChart(clima.editor.editorViewport)}drawFieldControl(e){var r=e.append("div").attr("class","row control-box"),o=r.append("div").attr("class","col-sm-6"),l=r.append("div").attr("class","col-sm-6");o.append("div").attr("class","row").append("h5").attr("class","container").text("Data Field");for(var c=o.append("select").attr("class","container custom-select").attr("id","field-select"),u=0;u<clima.utils.EPWDataFields.length;u++){var y=clima.utils.EPWDataFields[u],T=c.append("option").attr("value",u).text(y.name);this.field.key===y.key&&T.attr("selected","selected")}$(document).ready(function(){$("#field-select").change(function(v){var w=v.target.options[v.target.options.selectedIndex],O=w.value,k=clima.utils.EPWDataFields[Number.parseInt(O)];clima.editor.chart.field=k,clima.editor.chart.drawChart(clima.editor.editorViewport)})})}drawColorControl(e){var r=e.append("div").attr("class","row control-box"),o=r.append("div").attr("class","col-sm-6"),l=r.append("div").attr("class","col-sm-6");o.append("div").attr("class","row").append("h5").attr("class","container").text("High Value Color"),o.append("input").attr("type","color").attr("value",this.colorHigh).attr("class","container custom-select").attr("id","color-select1"),$(document).ready(function(){$("#color-select1").change(function(){var u=$("#color-select1").val();clima.editor.chart.colorHigh=u,clima.editor.chart.drawChart(clima.editor.editorViewport)})}),l.append("div").attr("class","row").append("h5").attr("class","container").text("Low Value Color"),l.append("input").attr("type","color").attr("value",this.colorLow).attr("class","container custom-select").attr("id","color-select2"),$(document).ready(function(){$("#color-select2").change(function(){var u=$("#color-select2").val();clima.editor.chart.colorLow=u,clima.editor.chart.drawChart(clima.editor.editorViewport),clima.editor.chart.resetTitle()})})}drawControls(e){e.selectAll("div").remove(),this.drawFieldControl(e),this.drawColorControl(e),this.drawTitleControl(e)}updateColor(){}}var clima=clima||{};clima.chart=clima.chart||{},clima.chart.tufteplot=clima.chart.tufteplot||{},clima.charts=clima.charts||[],clima.chart.tufteplot.name="Tufteplot",clima.chart.tufteplot.create=function(e){return new Tufteplot(e)},clima.charts.push(clima.chart.tufteplot);class Tufteplot{constructor(e){this.name="Tufteplot",this.board={},this.boardWidth=1250,this.boardHeight=410,this.boardTopMargin=60,this.boardBottomMargin=60,this.boardLeftMargin=60,this.boardRightMargin=110,this.graphicWidth=this.boardWidth-this.boardLeftMargin-this.boardRightMargin,this.graphicHeight=this.boardHeight-this.boardTopMargin-this.boardBottomMargin,this.data=e,this.dataSummary=[],this.dataMax=0,this.dataMin=0,this.field=clima.utils.getField("DryBulbTemp"),this.color="#1d5fab",this.radius=this.graphicWidth/365/4,this.title=this.name+" of "+this.field.name}summarizeDaily(){this.dataSummary=[];var e=[],r;this.dataMin=this.data.ticks[0].valueOf(this.field.key),this.dataMax=this.dataMin;for(var e,o=0;365>o;o++){e=[];for(var l=0;24>l;l++){r=this.data.ticks[24*o+l],e.push(r.valueOf(this.field.key));var c=r.valueOf(this.field.key);c<this.dataMin&&(this.dataMin=c),c>this.dataMax&&(this.dataMax=c)}var u={min:d3.min(e),max:d3.max(e),mean:d3.mean(e),q1:d3.quantile(e,0.25),q3:d3.quantile(e,0.75)};if(u.q1>u.q3){let y=u.q1;u.q1=u.q3,u.q3=y}this.dataSummary.push(u)}}drawChart(e){this.summarizeDaily(),e.selectAll("svg").remove(),this.board.svg=e.append("svg").attr("class","board").attr("width",this.boardWidth).attr("height",this.boardHeight).attr("viewBox","0 0 "+this.boardWidth+" "+this.boardHeight).attr("preserveAspectRatio","xMidYMid meet"),this.board.plots=this.board.svg.append("g").attr("class","tufteplot-plots").attr("transform","translate("+this.boardLeftMargin+","+this.boardTopMargin+")"),this.drawPlots(),this.board.xAxis=this.board.svg.append("g").attr("class","tufteplot-xAxis").attr("transform","translate("+this.boardLeftMargin+","+(1.04*this.graphicHeight+this.boardTopMargin)+")"),this.drawXAxis(),this.board.yAxis=this.board.svg.append("g").attr("class","tufteplot-yAxis").attr("transform","translate("+(this.boardLeftMargin-8)+","+this.boardTopMargin+")"),this.drawYAxis(),this.board.title=this.board.svg.append("g").attr("class","tufteplot-title"),this.drawTitle()}drawPlots(){var e=function(M,D){return D},r=d3.scaleLinear().domain([0,364]).range([0,this.graphicWidth]),o=function(M,D){return r(e(M,D))},l=this.field.key,c=1.1*(this.dataMax-this.dataMin),u=d3.scaleLinear().domain([this.dataMax,this.dataMin]).range([0,this.graphicHeight]),y=function(M){return u(M.q3)},T=function(M){return u(M.max)},v=function(M){return u(M.min)},w=function(M){return u(M.mean)},O=function(M){return Math.abs(u(M.q3)-u(M.q1))};this.board.plots.append("g").selectAll("rect").data(this.dataSummary).enter().append("rect").attr("class","tufteplot-iqr").attr("x",function(M,D){return o(M,D)}).attr("y",function(M){return y(M)}).attr("width",this.graphicWidth/365).attr("height",function(M){return O(M)}).attr("transform","translate("+-0.5*(this.graphicWidth/365)+","+0+")").attr("fill",d3.rgb(this.color)),this.board.plots.append("g").selectAll("rect").data(this.dataSummary).enter().append("rect").attr("class","tufteplot-mean").attr("x",function(M,D){return o(M,D)}).attr("y",function(M){return w(M)}).attr("width",this.graphicWidth/365).attr("height",0.5).attr("transform","translate("+-0.5*(this.graphicWidth/365)+","+0+")").attr("fill",d3.rgb("#ffffff")),this.board.plots.append("g").selectAll("circle").data(this.dataSummary).enter().append("circle").attr("class","tufteplot-max").attr("cx",function(M,D){return o(M,D)}).attr("cy",function(M){return T(M)}).attr("r",this.radius).attr("fill",d3.rgb(this.color)),this.board.plots.append("g").selectAll("circle").data(this.dataSummary).enter().append("circle").attr("class","tufteplot-min").attr("cx",function(M,D){return o(M,D)}).attr("cy",function(M){return v(M)}).attr("r",this.radius).attr("fill",d3.rgb(this.color))}drawXAxis(){var e=d3.scaleTime().domain([new Date(clima.utils.datetime.year,0,1),new Date(clima.utils.datetime.year,11,31)]).range([0,this.graphicWidth]),r=d3.axisBottom().scale(e).ticks(d3.timeMonth).tickSize(16,0).tickFormat(d3.timeFormat("%b"));this.board.xAxis.call(r),this.board.xAxis.selectAll("text").attr("transform","translate("+this.graphicWidth/24+", -10)"),this.board.xAxis.append("text").attr("x",this.graphicWidth/2).attr("y",40).text("Month of the Year").attr("text-anchor","middle").attr("font-family","sans-serif").attr("font-size","14px").attr("fill","black")}drawYAxis(){var e=this.field.key,r=1.1*(this.dataMax-this.dataMin),o=d3.scaleLinear().domain([this.dataMax,this.dataMin]).range([0,this.graphicHeight]),l=d3.axisLeft().scale(o).ticks(4);this.board.yAxis.call(l),this.board.yAxis.append("text").attr("x",-30).attr("y",this.graphicHeight/2).text(this.field.name+" ("+this.field.units+")").attr("text-anchor","middle").attr("transform","rotate(-90, -30, "+this.graphicHeight/2+")").attr("font-family","sans-serif").attr("font-size","14px").attr("fill","black")}drawTitle(){this.board.title.selectAll("text").remove(),this.board.title.append("text").attr("x",this.boardWidth/2).attr("y",this.boardTopMargin/2).text(this.title).attr("text-anchor","middle").attr("font-family","sans-serif").attr("font-size","24px").attr("fill","black")}drawTitleControl(e){var r=e.append("div").attr("class","row container control-box");r.append("div").attr("class","row").append("h5").attr("class","container").text("Chart Title");var o=r.append("div").attr("class","input-group mb-3");o.append("input").attr("type","text").attr("class","form-control").attr("id","chartTitle").attr("placeholder",this.title);var l=o.append("div").attr("class","input-group-append");l.append("button").attr("class","btn btn-outline-secondary").attr("type","button").attr("id","button-applyTitle").text("Apply"),l.append("button").attr("class","btn btn-outline-secondary").attr("type","button").attr("id","button-resetTitle").text("Reset"),$(document).ready(function(){$("#button-applyTitle").click(clima.editor.chart.applyTitle),$("#button-resetTitle").click(clima.editor.chart.resetTitle)})}applyTitle(){clima.editor.chart.title=$("#chartTitle").val(),clima.editor.chart.drawChart(clima.editor.editorViewport)}resetTitle(){clima.editor.chart.title=clima.editor.chart.name+" of "+clima.editor.chart.field.name+" in "+clima.editor.chart.data.location.city,$("#chartTitle").val(clima.editor.chart.title),clima.editor.chart.drawChart(clima.editor.editorViewport)}drawFieldControl(e){var r=e.append("div").attr("class","row control-box"),o=r.append("div").attr("class","col-sm-6"),l=r.append("div").attr("class","col-sm-6");o.append("div").attr("class","row").append("h5").attr("class","container").text("Data Field");for(var c=o.append("select").attr("class","container custom-select").attr("id","field-select"),u=0;u<clima.utils.EPWDataFields.length;u++){var y=clima.utils.EPWDataFields[u],T=c.append("option").attr("value",u).text(y.name);this.field.key===y.key&&T.attr("selected","selected")}$(document).ready(function(){$("#field-select").change(function(v){var w=v.target.options[v.target.options.selectedIndex],O=w.value,k=clima.utils.EPWDataFields[Number.parseInt(O)];clima.editor.chart.field=k,clima.editor.chart.drawChart(clima.editor.editorViewport),clima.editor.chart.resetTitle()})})}drawColorControl(e){var r=e.append("div").attr("class","row control-box"),o=r.append("div").attr("class","col-sm-6"),l=r.append("div").attr("class","col-sm-6");o.append("div").attr("class","row").append("h5").attr("class","container").text("Color"),o.append("input").attr("type","color").attr("value",this.color).attr("class","container custom-select").attr("id","color-select1"),$(document).ready(function(){$("#color-select1").change(function(){var u=$("#color-select1").val();clima.editor.chart.color=u,clima.editor.chart.drawChart(clima.editor.editorViewport)})})}drawControls(e){e.selectAll("div").remove(),this.drawFieldControl(e),this.drawColorControl(e),this.drawTitleControl(e)}}var clima=clima||{};clima.chart=clima.chart||{},clima.chart.scatterplot=clima.chart.scatterplot||{},clima.charts=clima.charts||[],clima.chart.scatterplot.name="Scatterplot",clima.chart.scatterplot.create=function(e){return new Scatterplot(e)},clima.charts.push(clima.chart.scatterplot);class Scatterplot{constructor(e){this.name="Scatterplot",this.board={},this.boardWidth=1250,this.boardHeight=410,this.boardTopMargin=60,this.boardBottomMargin=60,this.boardLeftMargin=60,this.boardRightMargin=110,this.graphicWidth=this.boardWidth-this.boardLeftMargin-this.boardRightMargin,this.graphicHeight=this.boardHeight-this.boardTopMargin-this.boardBottomMargin,this.data=e,this.fieldX=clima.utils.getField("DryBulbTemp"),this.fieldY=clima.utils.getField("RelHumid"),this.color="#1d5fab",this.radius=this.graphicWidth/500,this.title=this.name+" of "+this.fieldX.name+" by "+this.fieldY.name}drawChart(e){e.selectAll("svg").remove(),this.board.svg=e.append("svg").attr("class","board").attr("width",this.boardWidth).attr("height",this.boardHeight).attr("viewBox","0 0 "+this.boardWidth+" "+this.boardHeight).attr("preserveAspectRatio","xMidYMid meet"),this.board.points=this.board.svg.append("g").attr("class","scatterplot-points").attr("transform","translate("+this.boardLeftMargin+","+this.boardTopMargin+")"),this.drawPoints(),this.board.xAxis=this.board.svg.append("g").attr("class","scatterplot-xAxis").attr("transform","translate("+this.boardLeftMargin+","+(1.04*this.graphicHeight+this.boardTopMargin)+")"),this.drawXAxis(),this.board.yAxis=this.board.svg.append("g").attr("class","scatterplot-yAxis").attr("transform","translate("+(this.boardLeftMargin-8)+","+this.boardTopMargin+")"),this.drawYAxis(),this.board.title=this.board.svg.append("g").attr("class","scatterplot-title"),this.drawTitle()}drawPoints(){var e=this.fieldX.key,r=function(k){return k.valueOf(e)},o=d3.scaleLinear().domain(this.data.metaOf(e).domain).range([0,this.graphicWidth]),l=function(k){return o(r(k))},c=this.fieldY.key,u=function(k){return k.valueOf(c)},y=d3.scaleLinear().domain([this.data.metaOf(c).max,this.data.metaOf(c).min]).range([0,this.graphicHeight]),T=function(k){return y(u(k))},v=this.fieldX.units,w=this.fieldY.units,O=function(k){let M=r(k)+" "+v+" | "+u(k)+" "+w;return M};this.board.points.selectAll("circle").data(this.data.ticks).enter().append("circle").attr("class","scatterplot-points").attr("cx",function(k){return l(k)}).attr("cy",function(k){return T(k)}).attr("r",this.radius).attr("fill",d3.rgb(this.color)).append("svg:title").text(function(k){return O(k)})}drawXAxis(){var e=this.fieldX.key,r=d3.scaleLinear().domain(this.data.metaOf(e).domain).range([0,this.graphicWidth]),o=d3.axisBottom().scale(r).ticks(10);this.board.xAxis.call(o),this.board.xAxis.append("text").attr("x",this.graphicWidth/2).attr("y",40).text(this.fieldX.name+" ("+this.fieldX.units+")").attr("text-anchor","middle").attr("font-family","sans-serif").attr("font-size","14px").attr("fill","black")}drawYAxis(){var e=this.fieldY.key,r=d3.scaleLinear().domain([this.data.metaOf(e).max,this.data.metaOf(e).min-10]).range([0,this.graphicHeight]),o=d3.axisLeft().scale(r).ticks(8);this.board.yAxis.call(o),this.board.yAxis.append("text").attr("x",-30).attr("y",this.graphicHeight/2).text(this.fieldY.name+" ("+this.fieldY.units+")").attr("text-anchor","middle").attr("transform","rotate(-90, -30, "+this.graphicHeight/2+")").attr("font-family","sans-serif").attr("font-size","14px").attr("fill","black")}drawTitle(){this.board.title.selectAll("text").remove(),this.board.title.append("text").attr("x",this.boardWidth/2).attr("y",this.boardTopMargin/2).text(this.title).attr("text-anchor","middle").attr("font-family","sans-serif").attr("font-size","24px").attr("fill","black")}drawTitleControl(e){var r=e.append("div").attr("class","row container control-box");r.append("div").attr("class","row").append("h5").attr("class","container").text("Chart Title");var o=r.append("div").attr("class","input-group mb-3");o.append("input").attr("type","text").attr("class","form-control").attr("id","chartTitle").attr("placeholder",this.title);var l=o.append("div").attr("class","input-group-append");l.append("button").attr("class","btn btn-outline-secondary").attr("type","button").attr("id","button-applyTitle").text("Apply"),l.append("button").attr("class","btn btn-outline-secondary").attr("type","button").attr("id","button-resetTitle").text("Reset"),$(document).ready(function(){$("#button-applyTitle").click(clima.editor.chart.applyTitle),$("#button-resetTitle").click(clima.editor.chart.resetTitle)})}applyTitle(){clima.editor.chart.title=$("#chartTitle").val(),clima.editor.chart.drawChart(clima.editor.editorViewport)}resetTitle(){clima.editor.chart.title=clima.editor.chart.name+" of "+clima.editor.chart.fieldX.name+" by "+clima.editor.chart.fieldY.name+" in "+clima.editor.chart.data.location.city,$("#chartTitle").val(clima.editor.chart.title),clima.editor.chart.drawChart(clima.editor.editorViewport)}drawFieldControl(e){var r=e.append("div").attr("class","row control-box"),o=r.append("div").attr("class","col-sm-6"),l=r.append("div").attr("class","col-sm-6");o.append("div").attr("class","row").append("h5").attr("class","container").text("Data Field: X-Axis");for(var c=o.append("select").attr("class","container custom-select").attr("id","field-select"),u=0;u<clima.utils.EPWDataFields.length;u++){var y=clima.utils.EPWDataFields[u],T=c.append("option").attr("value",u).text(y.name);this.fieldX.key===y.key&&T.attr("selected","selected")}$(document).ready(function(){$("#field-select").change(function(w){var O=w.target.options[w.target.options.selectedIndex],k=O.value,M=clima.utils.EPWDataFields[Number.parseInt(k)];clima.editor.chart.fieldX=M,clima.editor.chart.drawChart(clima.editor.editorViewport),clima.editor.chart.resetTitle()})}),l.append("div").attr("class","row").append("h5").attr("class","container").text("Data Field: Y-Axis");for(var v=l.append("select").attr("class","container custom-select").attr("id","field-select2"),u=0;u<clima.utils.EPWDataFields.length;u++){var y=clima.utils.EPWDataFields[u],T=v.append("option").attr("value",u).text(y.name);this.fieldY.key===y.key&&T.attr("selected","selected")}$(document).ready(function(){$("#field-select2").change(function(w){var O=w.target.options[w.target.options.selectedIndex],k=O.value,M=clima.utils.EPWDataFields[Number.parseInt(k)];clima.editor.chart.fieldY=M,clima.editor.chart.drawChart(clima.editor.editorViewport),clima.editor.chart.resetTitle()})})}drawColorControl(e){var r=e.append("div").attr("class","row control-box"),o=r.append("div").attr("class","col-sm-6"),l=r.append("div").attr("class","col-sm-6");o.append("div").attr("class","row").append("h5").attr("class","container").text("Color"),o.append("input").attr("type","color").attr("value",this.color).attr("class","container custom-select").attr("id","color-select1"),$(document).ready(function(){$("#color-select1").change(function(){var u=$("#color-select1").val();clima.editor.chart.color=u,clima.editor.chart.drawChart(clima.editor.editorViewport)})})}drawControls(e){e.selectAll("div").remove(),this.drawFieldControl(e),this.drawColorControl(e),this.drawTitleControl(e)}}var clima=clima||{};clima.chart=clima.chart||{},clima.chart.psychrometric=clima.chart.psychrometric||{},clima.charts=clima.charts||[],clima.chart.psychrometric.name="Psychrometric",clima.chart.psychrometric.create=function(e){return new Psychrometric(e)},clima.charts.push(clima.chart.psychrometric);class Psychrometric{constructor(e){this.name="Psychrometric Chart",this.board={},this.boardWidth=1250,this.boardHeight=810,this.boardTopMargin=60,this.boardBottomMargin=60,this.boardLeftMargin=60,this.boardRightMargin=110,this.graphicWidth=this.boardWidth-this.boardLeftMargin-this.boardRightMargin,this.graphicHeight=this.boardHeight-this.boardTopMargin-this.boardBottomMargin,this.data=e,this.fieldX=clima.utils.getField("DryBulbTemp"),this.fieldY=clima.utils.getField("RelHumid"),this.color="#1d5fab",this.radius=this.graphicWidth/350,this.title=this.name,this.minDB,this.maxDB}drawChart(e){this.minDB=this.data.metaOf("DryBulbTemp").min-2.5,this.maxDB=this.data.metaOf("DryBulbTemp").max+2.5,e.selectAll("svg").remove(),this.board.svg=e.append("svg").attr("class","board").attr("width",this.boardWidth).attr("height",this.boardHeight).attr("viewBox","0 0 "+this.boardWidth+" "+this.boardHeight).attr("preserveAspectRatio","xMidYMid meet"),this.board.clipPath=this.board.svg.append("clipPath").attr("id","clip").append("rect").attr("x","0").attr("y","0").attr("width",this.graphicWidth).attr("height",this.graphicHeight).attr("transform","translate("+this.boardLeftMargin+","+this.boardTopMargin+")"),this.board.lines=this.board.svg.append("g").attr("class","psychrometric-lines").attr("transform","translate("+this.boardLeftMargin+","+this.boardTopMargin+")"),this.drawLines(),this.board.points=this.board.svg.append("g").attr("class","psychrometric-points").attr("transform","translate("+this.boardLeftMargin+","+this.boardTopMargin+")"),this.drawPoints(),this.board.xAxis=this.board.svg.append("g").attr("class","psychrometric-xAxis").attr("transform","translate("+this.boardLeftMargin+","+(this.graphicHeight+this.boardTopMargin)+")"),this.drawXAxis(),this.board.yAxis=this.board.svg.append("g").attr("class","psychrometric-yAxis").attr("transform","translate("+(this.boardLeftMargin+this.graphicWidth)+","+this.boardTopMargin+")"),this.drawYAxis(),this.board.title=this.board.svg.append("g").attr("class","psychrometric-title"),this.drawTitle()}static satpress(e){var S,r=e+273.15,c=-0.9677843*Math.pow(10,-2),u=0.62215701*Math.pow(10,-6),y=0.20747825*Math.pow(10,-8),T=-0.9484024*Math.pow(10,-12),M=0.41764768*Math.pow(10,-4),D=-0.14452093*Math.pow(10,-7);return 273.15>r?S=Math.exp(-5674.5359/r+6.3925247+r*(c+r*(u+r*(y+T*r)))+4.1635019*Math.log(r)):273.15<=r&&(S=Math.exp(-5800.2206/r+1.3914993+r*(-0.048640239+r*(M+r*D))+6.5459673*Math.log(r))),S}static humRatio(e,r){let o=r*Psychrometric.satpress(e)/100;return 0.62198*o/(101325-o)}drawLines(){let e=d3.scaleLinear().range([0,this.graphicWidth]).domain([this.minDB,this.maxDB]),r=d3.scaleLinear().range([0,this.graphicHeight]).domain([30,0]),o=d3.line().x(function(u){return e(u.db)}).y(function(u){return r(1e3*u.hr)});for(var l=100;10<=l;l-=10){let u=[];for(var c=this.minDB;c<=this.maxDB;c+=0.5){let y=Psychrometric.humRatio(c,l);u.push({db:c,hr:y})}100==l?this.board.lines.append("path").attr("d",o(u)).attr("class","rh100").attr("stroke","black").attr("clip-path","url(#clip)").attr("fill","none"):this.board.lines.append("path").attr("d",o(u)).attr("class","rhline").attr("stroke","gray").attr("clip-path","url(#clip)").attr("fill","none")}}drawPoints(){let e=function(O){return O.valueOf("DryBulbTemp")},r=d3.scaleLinear().range([0,this.graphicWidth]).domain([this.minDB,this.maxDB]),o=function(O){return r(e(O))},l=function(O){var k=O.valueOf("DryBulbTemp"),M=O.valueOf("RelHumid");return Psychrometric.humRatio(k,M)},c=d3.scaleLinear().range([0,this.graphicHeight]).domain([30,0]),u=function(O){return c(1e3*l(O))};var y=this.fieldX.units,T=this.fieldY.units,v=d3.format(".2f"),w=function(O){let k=e(O)+" "+y+"\n"+v(1e3*l(O))+" g\u02B7/kg\u1D48\u1D43";return k};this.board.points.selectAll("circle").data(this.data.ticks).enter().append("circle").attr("class","scatterplot-points").attr("cx",function(O){return o(O)}).attr("cy",function(O){return u(O)}).attr("r",this.radius).attr("fill",d3.rgb(this.color)).attr("fill-opacity","0.8").append("svg:title").text(function(O){return w(O)})}drawXAxis(){var e=d3.scaleLinear().domain([this.minDB,this.maxDB]).range([0,this.graphicWidth]),r=d3.axisBottom().scale(e).ticks(10);this.board.xAxis.call(r),this.board.xAxis.append("text").attr("x",this.graphicWidth/2).attr("y",40).text(this.fieldX.name+" ("+this.fieldX.units+")").attr("text-anchor","middle").attr("font-family","sans-serif").attr("font-size","14px").attr("fill","black")}drawYAxis(){let e=d3.scaleLinear().range([0,this.graphicHeight]).domain([30,0]);var r=d3.axisRight().scale(e).ticks(8);this.board.yAxis.call(r),this.board.yAxis.append("text").attr("x",30).attr("y",this.graphicHeight/2).text("Humidity Ratio (g\u02B7/kg\u1D48\u1D43)").attr("text-anchor","middle").attr("transform","rotate(90, 30, "+this.graphicHeight/2+")").attr("font-family","sans-serif").attr("font-size","14px").attr("fill","black")}drawTitle(){this.board.title.selectAll("text").remove(),this.board.title.append("text").attr("x",this.boardWidth/2).attr("y",this.boardTopMargin/2).text(this.title).attr("text-anchor","middle").attr("font-family","sans-serif").attr("font-size","24px").attr("fill","black")}drawTitleControl(e){var r=e.append("div").attr("class","row container control-box");r.append("div").attr("class","row").append("h5").attr("class","container").text("Chart Title");var o=r.append("div").attr("class","input-group mb-3");o.append("input").attr("type","text").attr("class","form-control").attr("id","chartTitle").attr("placeholder",this.title);var l=o.append("div").attr("class","input-group-append");l.append("button").attr("class","btn btn-outline-secondary").attr("type","button").attr("id","button-applyTitle").text("Apply"),l.append("button").attr("class","btn btn-outline-secondary").attr("type","button").attr("id","button-resetTitle").text("Reset"),$(document).ready(function(){$("#button-applyTitle").click(clima.editor.chart.applyTitle),$("#button-resetTitle").click(clima.editor.chart.resetTitle)})}applyTitle(){clima.editor.chart.title=$("#chartTitle").val(),clima.editor.chart.drawChart(clima.editor.editorViewport)}resetTitle(){clima.editor.chart.title=clima.editor.chart.name+" in "+clima.editor.chart.data.location.city,$("#chartTitle").val(clima.editor.chart.title),clima.editor.chart.drawChart(clima.editor.editorViewport)}drawColorControl(e){var r=e.append("div").attr("class","row control-box"),o=r.append("div").attr("class","col-sm-6"),l=r.append("div").attr("class","col-sm-6");o.append("div").attr("class","row").append("h5").attr("class","container").text("Color"),o.append("input").attr("type","color").attr("value",this.color).attr("class","container custom-select").attr("id","color-select1"),$(document).ready(function(){$("#color-select1").change(function(){var u=$("#color-select1").val();clima.editor.chart.color=u,clima.editor.chart.drawChart(clima.editor.editorViewport)})})}drawControls(e){e.selectAll("div").remove(),this.drawColorControl(e),this.drawTitleControl(e)}}var clima=clima||{};clima.data=clima.data||{},clima.data.Tick=function(e,r){this.ts=e,this.hourOfYear=e.hourOfYear(),this.data=r},clima.data.Tick.prototype.valueOf=function(e){return e.constructor===Array?this.data[e[0]][e[1]]:this.data[Object.keys(this.data)[0]][e]},clima.data.Tick.prototype.hourOfYear=function(){return this.ts.hourOfYear()},clima.data.Tick.prototype.dayOfYear=function(){return this.ts.dayOfYear()},clima.data.Tick.prototype.hourOfDay=function(){return this.ts.hourOfDay()},clima.data.Tick.prototype.monthOfYear=function(){return this.ts.monthOfYear()},clima.data.Tick.prototype.season=function(){return this.ts.season()},clima.data.Tick.prototype.isIn=function(e){return e.contains(this.ts.mid)},clima.data.STick=function(e,r){this.ts=e,this.data=r},clima.data.STick.prototype.metaOf=function(e){return e.constructor===Array?this.data[e[0]][e[1]]:this.data[Object.keys(this.data)[0]][e]},clima.data.STick.prototype.averageOf=function(e){return this.metaOf(e).average},clima.data.STick.prototype.domainOf=function(e){return this.metaOf(e).domain},clima.data.STick.prototype.maxOf=function(e){return this.metaOf(e).max},clima.data.STick.prototype.medianOf=function(e){return this.metaOf(e).median},clima.data.STick.prototype.minOf=function(e){return this.metaOf(e).min},clima.data.STick.prototype.q1Of=function(e){return this.metaOf(e).q1},clima.data.STick.prototype.q2Of=function(e){return this.metaOf(e).q2},clima.data.STick.prototype.q3Of=function(e){return this.metaOf(e).q3},clima.data.STick.prototype.hourOfYear=function(){return this.ts.hourOfYear()},clima.data.STick.prototype.dayOfYear=function(){return this.ts.dayOfYear()},clima.data.STick.prototype.hourOfDay=function(){return this.ts.hourOfDay()},clima.data.STick.prototype.monthOfYear=function(){return this.ts.monthOfYear()},clima.data.STick.prototype.isIn=function(e){return e.contains(this.ts.mid)};var clima=clima||{};clima.data=clima.data||{},clima.data.Year=function(e,r){this.schema=e,this.ticks=r},clima.data.Year.prototype.metaOf=function(e){return e.constructor===Array?this.schema[e[0]][e[1]]:this.schema[Object.keys(this.schema)[0]][e]},clima.data.Year.prototype.valuesOf=function(e){return this.ticks.map(function(r){return r.valueOf(e)})},clima.data.Year.prototype.dailySummary=function(e=1){for(var r=[],o=0;o<this.ticks.length;){var l=dY.timeSpan.hoursOfYear(o,o+24*e-1),c=dY.util.summarizeTicks(this.schema,ticks.slice(o,o+24*e));r.push(new dY.STick(l,c)),o+=24*e}return r},clima.data.hourOfDaySummary=function(e,r){var o={};for(var l in r){var c=r[l].hourOfDay();o.hasOwnProperty(c)||(o[c]=[]),o[c].push(r[l])}var u=[];for(var c in o){var y=dY.timeSpan.hourOfYear(parseInt(c)),T=dY.util.summarizeTicks(e,o[c]),v=new dY.STick(y,T);u.push(v)}return u};var clima=clima||{};clima.utils=clima.utils||{},clima.worldMap={},clima.worldMap.svg={},clima.utils.loader=clima.utils.loader||{},clima.utils.parser=clima.utils.parser||{},clima.utils.loader.loadInitial=function(e){splt=e.split("\n"),head=splt.slice(0,8).join("\n"),body=splt.slice(8,splt.length).join("\n"),console.log("clima: Reading Initial Data"),Papa.parse(body,{delimiter:",",skipEmptyLines:!0,header:!1,dynamicTyping:!0,complete:function(o){clima.utils.parser.parseEPW(head,o,clima.utils.onDataLoaded)}})},clima.utils.loader.loadEPW=function(e){var r=e.target.files[0],o=new FileReader;o.onload=function(){splt=this.result.split("\n"),head=splt.slice(0,8).join("\n"),body=splt.slice(8,splt.length).join("\n"),console.log("clima: Reading EPW File"),Papa.parse(body,{delimiter:",",skipEmptyLines:!0,header:!1,dynamicTyping:!0,complete:function(l){clima.utils.parser.parseEPW(head,l,clima.utils.onDataLoaded)}}),clima.utils.mapClimateData()},o.readAsText(r)},clima.utils.parser.parseEPW=function(e,r,o){return(console.log("clima: Parsing EPW File"),!clima.utils.parser.handleErrors(r))?(console.log("clima: Parser failed. Aborting"),!1):(schema={EPW:{}},clima.utils.EPWDataFields.forEach(function(l){schema.EPW[l.key]={}}),console.log("clima: Parser found "+r.data.length+" rows"),ticks=[],r.data.forEach(function(l){datestring=clima.utils.pad(l[1])+"/"+clima.utils.pad(l[2])+"  "+clima.utils.pad(l[3])+":00",hourOfYear=clima.utils.datetime.dateToHourOfYear(clima.utils.datetime.dateStringToDate(datestring)),timespan=clima.TimeSpan.hourOfYear(hourOfYear),data={},data.EPW={},clima.utils.EPWDataFields.forEach(function(u){value=l[u.col],data.EPW[u.key]=value}),ticks.push(new clima.data.Tick(timespan,data))}),schema=clima.utils.parser.summarizeTicks(schema,ticks),yr=new clima.data.Year(schema,ticks),yr=clima.utils.parser.parseEPWHeader(yr,e),"undefined"==typeof o?yr:void o(yr))},clima.utils.onDataLoaded=function(e){clima.climates||(clima.climates=[]);for(var l,r=!1,o=0;o<clima.climates.length;o++)l=clima.climates[o],l.location.city===e.location.city&&(r=!0);r||(clima.currentClimate=e,clima.climates.push(e))},clima.utils.parser.parseEPWHeader=function(e,r){var o=r.split("\n"),l=o[0].split(","),c=o[1].split(","),u=o[2].split(","),y=o[3].split(","),T=o[4].split(","),v=o[5].split(","),w=o[6].split(",");e.epwhead={},e.location={city:l[1],state:l[2],country:l[3],source:l[4],wmo:parseInt(l[5]),latitude:parseFloat(l[6]),longitude:parseFloat(l[7]),timezone:parseFloat(l[8]),elevation:parseFloat(l[9])},e.epwhead.designConditions={source:c[2],note:"dY.parser doesn't currently handle most design condition data. Consider contributing to dY on GitHub!"},e.epwhead.holidaysDaylightSavings={leapYearObserved:"Yes"==T[1],note:"dY.parser doesn't currently handle most Holiday/Daylight Savings data. Consider contributing to dY on GitHub!"},e.epwhead.comments={comments1:v,comments2:w,note:"dY.parser doesn't currently handle most comment data. Consider contributing to dY on GitHub!"},e.epwhead.periods={};for(var M,O=parseInt(u[1]),k=2;k<4*O+2;k+=4){M=u[k+1].toLowerCase(),e.epwhead.periods.hasOwnProperty(M)||(e.epwhead.periods[M]=[]);var D=[clima.utils.datetime.dateToHourOfYear(Date.parse(u[k+2]+"/"+clima.utils.datetime.year+" 00:30:00 UTC")),clima.utils.datetime.dateToHourOfYear(Date.parse(u[k+3]+"/"+clima.utils.datetime.year+" 23:30:00 UTC"))];e.epwhead.periods[M].push({name:u[k],domainStr:[u[k+2],u[k+3]],domain:D})}e.epwhead.ground=[];for(var A,C=parseInt(y[1]),S=2;S<16*C+2;S+=16){A={},A.depth=parseFloat(y[S]),A.conductivity=parseFloat(y[S+1]),A.density=parseFloat(y[S+2]),A.specificHeat=parseFloat(y[S+3]),A.monthlyTemperature=[];for(var Y=0;12>Y;Y++)A.monthlyTemperature.push(parseFloat(y[S+Y+4]));e.epwhead.ground.push(A)}return e},clima.utils.parser.handleErrors=function(e){return 0<e.errors.length&&(console.log("clima: Parser encountered "+e.errors.length+" error(s)"),e.errors.forEach(function(r,o){"TooFewFields"==r.code&&r.row==e.data.length-1?(console.log("\tThe last row contained improperly formatted data"),e.data.splice(e.data.length-1,1)):dY.report("\t"+o+"\t"+r.code+"; "+r.message+"; row: "+r.row)})),!0},clima.utils.parser.summarizeTicks=function(e,r){var o={},l=[];for(var c in e)for(var u in o[c]={},e[c])o[c][u]={},l[[c,u]]=[];for(var y in r)for(var c in e)for(var u in e[c])l[[c,u]].push(r[y].data[c][u]);for(var c in e)for(var u in e[c]){var T=l[[c,u]].sort(function(k,M){return k-M}),v=T.length;o[c][u].min=T[0],o[c][u].q1=T[Math.floor(.25*v)-1],o[c][u].q2=T[Math.floor(0.5*v)-1],o[c][u].q3=T[Math.floor(.75*v)-1],o[c][u].max=T[v-1],o[c][u].domain=[o[c][u].min,o[c][u].max],o[c][u].median=o[c][u].q2;for(var w=0,O=0;O<T.length;O++)w+=T[O];o[c][u].average=w/v}return o},clima.utils.pad=function(e){return 10>e?"0"+e:e},clima.utils.getField=function(e){for(var o,r=0;r<clima.utils.EPWDataFields.length;r++)if(o=clima.utils.EPWDataFields[r],o.key===e)return o},clima.utils.EPWDataFields=[{key:"EtRadHorz",units:"Wh/m\xB2",col:10,name:"Extraterrestrial Horizontal Radiation",description:"TODO: Add Description"},{key:"EtRadNorm",units:"Wh/m\xB2",col:11,name:"Extraterrestrial Direct Normal Radiation",description:"TODO: Add Description"},{key:"GblHorzIrad",units:"Wh/m\xB2",col:13,name:"Global Horizontal Radiation",description:"TODO: Add Description"},{key:"DirNormIrad",units:"Wh/m\xB2",col:14,name:"Direct Normal Radiation",description:"TODO: Add Description"},{key:"DifHorzIrad",units:"Wh/m\xB2",col:15,name:"Diffuse Horizontal Radiation",description:"TODO: Add Description"},{key:"GblHorzIllum",units:"lux",col:16,name:"Global Horizontal Illuminance",description:"TODO: Add Description"},{key:"DirNormIllum",units:"lux",col:17,name:"Direct Normal Illuminance",description:"TODO: Add Description"},{key:"DifHorzIllum",units:"lux",col:18,name:"Diffuse Horizontal Illuminance",description:"TODO: Add Description"},{key:"ZenLum",units:"Cd/m\xB2",col:19,name:"Zenith Luminance",description:"TODO: Add Description"},{key:"TotSkyCvr",units:"tenths of coverage",col:22,name:"Total Sky Cover",description:"TODO: Add Description"},{key:"OpqSkyCvr",units:"tenths of coverage",col:23,name:"Opaque Sky Cover",description:"TODO: Add Description"},{key:"DryBulbTemp",units:"\xB0C",col:6,name:"Dry Bulb Temperature",description:"TODO: Add Description"},{key:"DewPtTemp",units:"\xB0C",col:7,name:"Dew Point Temperature",description:"TODO: Add Description"},{key:"RelHumid",units:"%",col:8,name:"Relative Humidity",description:"TODO: Add Description"},{key:"Pressure",units:"Pa",col:9,name:"Atmospheric Station Pressure",description:"TODO: Add Description"},{key:"WindDir",units:"\xB0CW of North",col:20,name:"Wind Direction",description:"TODO: Add Description"},{key:"WindSpd",units:"m/s",col:21,name:"Wind Speed",description:"TODO: Add Description"},{key:"HorzVis",units:"km",col:24,name:"Horizontal Visibility",description:"TODO: Add Description"},{key:"CeilHght",units:"m",col:25,name:"Ceiling Height",description:"TODO: Add Description"},{key:"PreciptWater",units:"mm",col:28,name:"Precipitable Water",description:"TODO: Add Description"},{key:"AeroDepth",units:"1/1000",col:29,name:"Aerosol Optical Depth",description:"TODO: Add Description"},{key:"SnowDepth",units:"cm",col:30,name:"Snow Depth",description:"TODO: Add Description"},{key:"DaysSinceSnow",units:"days",col:31,name:"Days Since Last Snowfall",description:"TODO: Add Description"}],clima.utils.datetime={},clima.utils.datetime.year=1970,clima.utils.datetime.minsPerYr=525600,clima.utils.datetime.millsPerMin=6e4,clima.utils.datetime.millsToMins=1.666666e-5,clima.utils.datetime.dateToHourOfYear=function(e){return start=new Date(Date.UTC(clima.utils.datetime.year,0,1,0,30)),diff=e-start,hour=Math.floor(diff/3600000),hour},clima.utils.datetime.hourOfYearToDate=function(e){return new Date((e+0.5)*3600000)},clima.utils.datetime.dateStringToDate=function(e){return splt=e.split("  "),date=splt[0].trim().split("/"),month=parseInt(date[0])-1,day=parseInt(date[1]),hour=parseInt(splt[1].trim().split(":")[0])-1,dt=new Date(Date.UTC(clima.utils.datetime.year,month,day,hour,30)),dt},clima.utils.datetime.niceFormat=function(e){var r=clima.utils.datetime.monthTable[e.getUTCMonth()].shortname,o=e.getUTCDate(),l=e.getUTCHours(),c=e.getUTCMinutes(),u=function(y){return 10>y?"0"+y:y};return u(o)+" "+r+" "+u(l)+":"+u(c)},clima.utils.datetime.monthTable=[{idx:0,fullname:"January",shortname:"Jan",domain:[Date.UTC(clima.utils.datetime.year,0,1,0,0,0,0)*clima.utils.datetime.millsToMins,Date.UTC(clima.utils.datetime.year,1,1,0,0,0,0)*clima.utils.datetime.millsToMins]},{idx:1,fullname:"February",shortname:"Feb",domain:[Date.UTC(clima.utils.datetime.year,1,1,0,0,0,0)*clima.utils.datetime.millsToMins,Date.UTC(clima.utils.datetime.year,2,1,0,0,0,0)*clima.utils.datetime.millsToMins]},{idx:2,fullname:"March",shortname:"Mar",domain:[Date.UTC(clima.utils.datetime.year,2,1,0,0,0,0)*clima.utils.datetime.millsToMins,Date.UTC(clima.utils.datetime.year,3,1,0,0,0,0)*clima.utils.datetime.millsToMins]},{idx:3,fullname:"April",shortname:"Apr",domain:[Date.UTC(clima.utils.datetime.year,3,1,0,0,0,0)*clima.utils.datetime.millsToMins,Date.UTC(clima.utils.datetime.year,4,1,0,0,0,0)*clima.utils.datetime.millsToMins]},{idx:4,fullname:"May",shortname:"May",domain:[Date.UTC(clima.utils.datetime.year,4,1,0,0,0,0)*clima.utils.datetime.millsToMins,Date.UTC(clima.utils.datetime.year,5,1,0,0,0,0)*clima.utils.datetime.millsToMins]},{idx:5,fullname:"June",shortname:"Jun",domain:[Date.UTC(clima.utils.datetime.year,5,1,0,0,0,0)*clima.utils.datetime.millsToMins,Date.UTC(clima.utils.datetime.year,6,1,0,0,0,0)*clima.utils.datetime.millsToMins]},{idx:6,fullname:"July",shortname:"Jul",domain:[Date.UTC(clima.utils.datetime.year,6,1,0,0,0,0)*clima.utils.datetime.millsToMins,Date.UTC(clima.utils.datetime.year,7,1,0,0,0,0)*clima.utils.datetime.millsToMins]},{idx:7,fullname:"August",shortname:"Aug",domain:[Date.UTC(clima.utils.datetime.year,7,1,0,0,0,0)*clima.utils.datetime.millsToMins,Date.UTC(clima.utils.datetime.year,8,1,0,0,0,0)*clima.utils.datetime.millsToMins]},{idx:8,fullname:"September",shortname:"Sep",domain:[Date.UTC(clima.utils.datetime.year,8,1,0,0,0,0)*clima.utils.datetime.millsToMins,Date.UTC(clima.utils.datetime.year,9,1,0,0,0,0)*clima.utils.datetime.millsToMins]},{idx:9,fullname:"October",shortname:"Oct",domain:[Date.UTC(clima.utils.datetime.year,9,1,0,0,0,0)*clima.utils.datetime.millsToMins,Date.UTC(clima.utils.datetime.year,10,1,0,0,0,0)*clima.utils.datetime.millsToMins]},{idx:10,fullname:"November",shortname:"Nov",domain:[Date.UTC(clima.utils.datetime.year,10,1,0,0,0,0)*clima.utils.datetime.millsToMins,Date.UTC(clima.utils.datetime.year,11,1,0,0,0,0)*clima.utils.datetime.millsToMins]},{idx:11,fullname:"December",shortname:"Dec",domain:[Date.UTC(clima.utils.datetime.year,11,1,0,0,0,0)*clima.utils.datetime.millsToMins,Date.UTC(clima.utils.datetime.year+1,0,1,0,0,0,0)*clima.utils.datetime.millsToMins]}],clima.utils.datetime.winterSolstice=Date.UTC(clima.utils.datetime.year,11,21,0,0,0,0)*clima.utils.datetime.millsToMins,clima.utils.datetime.springEquinox=Date.UTC(clima.utils.datetime.year,2,21,0,0,0,0)*clima.utils.datetime.millsToMins,clima.utils.datetime.summerSolstice=Date.UTC(clima.utils.datetime.year,5,21,0,0,0,0)*clima.utils.datetime.millsToMins,clima.utils.datetime.autumnalEquinox=Date.UTC(clima.utils.datetime.year,8,21,0,0,0,0)*clima.utils.datetime.millsToMins,clima.utils.datetime.seasonTable=[{idx:0,fullname:"Winter",domain:[clima.utils.datetime.winterSolstice,clima.utils.datetime.springEquinox+clima.utils.datetime.minsPerYr]},{idx:1,fullname:"Spring",domain:[clima.utils.datetime.springEquinox,clima.utils.datetime.summerSolstice]},{idx:2,fullname:"Summer",domain:[clima.utils.datetime.summerSolstice,clima.utils.datetime.autumnalEquinox]},{idx:3,fullname:"Autumn",domain:[clima.utils.datetime.autumnalEquinox,clima.utils.datetime.winterSolstice]}],clima.utils.mapClimateData=function(){var r=d3.select("#climate-list");r.selectAll("li").data(clima.climates).enter().append("li").attr("class","list-group-item").text(function(o){return o.location.city+" | "+o.location.country+" | "+o.location.latitude+" | "+o.location.longitude}),clima.worldMap.svg.selectAll("circle").data(clima.climates).enter().append("circle").attr("class","geo-data").attr("r","3").attr("transform",function(o){return"translate("+clima.worldMap.projection([o.location.longitude,o.location.latitude])+")"})};var clima=clima||{};clima.TimeSpan=function(e,r){if("[object Date]"==Object.prototype.toString.call(e)&&(e=+e),"[object Date]"==Object.prototype.toString.call(r)&&(r=+r),r<=e)throw"timeSpans cannot be constructed backwards";if(0>e||0>r)throw"timeSpans cannot be negative";if(e>clima.utils.datetime.minsPerYr&&r>clima.utils.datetime.minsPerYr)throw"timeSpans should be constructed from a generic UTC year (1970)";this.spansYears=!1,r>clima.utils.datetime.minsPerYr&&(this.spansYears=!0);var o=Math.ceil(e),l=Math.floor(r);this._=clima.utils.datetime.niceFormat(new Date(60*(1e3*o)))+" -> "+clima.utils.datetime.niceFormat(new Date(60*(1e3*l))),this.min=o,this.max=l,this.mid=0.5*(l-o)+o,this.hourOfYearStart=function(){return Math.round(o/60)},this.hourOfYearMid=function(){return this.mid/60},this.hourOfYearEnd=function(){return Math.round(l/60)},this.hourOfYear=function(){return Math.floor(this.hourOfYearMid())},this.hourOfYearDomain=function(){return[this.hourOfYearStart(),this.hourOfYearEnd()-1]},this.hoursOfYear=function(){return Array.from(Array(this.durationHrs()),(c,u)=>u+this.hourOfYearStart())},this.dayOfYear=function(){return Math.floor(this.hourOfYear()/24)},this.hourOfDay=function(){return this.hourOfYear()%24},this.monthOfYear=function(){return new Date(60*(1e3*this.mid)).getUTCMonth()},this.season=function(){return clima.TimeSpan.season(0).contains(this)?0:clima.TimeSpan.season(1).contains(this)?1:clima.TimeSpan.season(2).contains(this)?2:clima.TimeSpan.season(3).contains(this)?3:void 0},this.duration=function(){return l-o},this.durationHrs=function(){return Math.round((l-o)/60)},this.isHour=function(){return 1==this.durationHrs()}},clima.TimeSpan.prototype.contains=function(e){return"[object Number]"!==Object.prototype.toString.call(e)&&e.hasOwnProperty("mid")&&(e=e.mid),(0>e||e>clima.utils.datetime.minsPerYr)&&console.warn("You asked timeSpan.contains("+e+"). timeSpans describe minutes of a generic UTC year (1970), so that  contained values must lie between 0 and "+clima.utils.datetime.minsPerYr),this.spansYears?!!(e>=this.min)||!!(e<this.max-clima.utils.datetime.minsPerYr):e>=this.min&&e<this.max},clima.TimeSpan.prototype.report=function(){console.log(this._),console.log("\t hoy domain \t\t"+this.hourOfYearDomain()),console.log("\t mid hr \t\t"+this.hourOfYearMid()),console.log("\t dur\t\t"+this.duration()),console.log("\t durHrs\t\t"+this.durationHrs()),console.log("\t hour of year\t\t"+this.hourOfYear()),console.log("\t day of year\t\t"+this.dayOfYear()),console.log("\t hour of day\t\t"+this.hourOfDay()),console.log("\t month of year\t\t"+this.monthOfYear())},clima.TimeSpan.hourOfYear=function(e){return new clima.TimeSpan(60*e,60*(e+1))},clima.TimeSpan.hoursOfYear=function(e,r){return new clima.TimeSpan(60*e,60*r)},clima.TimeSpan.dayOfYear=function(e){return new clima.TimeSpan(60*(24*e),60*(24*(e+1)))},clima.TimeSpan.daysOfYear=function(e,r){return new clima.TimeSpan(60*(24*e),60*(24*(r+1)))},clima.TimeSpan.monthOfYear=function(e){return new clima.TimeSpan(clima.utils.datetime.monthTable[e].domain[0],clima.utils.datetime.monthTable[e].domain[1])},clima.TimeSpan.monthsOfYear=function(e,r){return new clima.TimeSpan(clima.utils.datetime.monthTable[e].domain[0],clima.utils.datetime.monthTable[r].domain[1])},clima.TimeSpan.fullYear=new clima.TimeSpan(0,525600),clima.TimeSpan.janurary=clima.TimeSpan.monthOfYear(0),clima.TimeSpan.february=clima.TimeSpan.monthOfYear(1),clima.TimeSpan.march=clima.TimeSpan.monthOfYear(2),clima.TimeSpan.april=clima.TimeSpan.monthOfYear(3),clima.TimeSpan.may=clima.TimeSpan.monthOfYear(4),clima.TimeSpan.june=clima.TimeSpan.monthOfYear(5),clima.TimeSpan.july=clima.TimeSpan.monthOfYear(6),clima.TimeSpan.august=clima.TimeSpan.monthOfYear(7),clima.TimeSpan.september=clima.TimeSpan.monthOfYear(8),clima.TimeSpan.october=clima.TimeSpan.monthOfYear(9),clima.TimeSpan.november=clima.TimeSpan.monthOfYear(10),clima.TimeSpan.december=clima.TimeSpan.monthOfYear(11),clima.TimeSpan.season=function(e){return new clima.TimeSpan(clima.utils.datetime.seasonTable[e].domain[0],clima.utils.datetime.seasonTable[e].domain[1])},clima.TimeSpan.winter=clima.TimeSpan.season(0),clima.TimeSpan.spring=clima.TimeSpan.season(1),clima.TimeSpan.summer=clima.TimeSpan.season(2),clima.TimeSpan.fall=clima.TimeSpan.season(3),clima.TimeSpan.autumn=clima.TimeSpan.season(3);var clima=clima||{};clima.viewport=clima.viewport||{},clima.viewport.idCounter=clima.viewport.idCounter||0,clima.currentClimate=clima.currentClimate||!1,clima.defaultClimate=clima.currentClimate,clima.chart=clima.chart||{},clima.viewports=clima.viewports||[],clima.charts=clima.charts||[],clima.defaultChart=clima.charts[0];class Viewport{constructor(e){this.parent=e,this.id=clima.viewport.idCounter++,this.element=e.append("div").attr("class","container viewport").attr("id","viewport_"+this.id),this.controlBar=this.element.append("div").attr("class","container viewport-control-bar")}update(){this.chart.drawChart(this.element)}drawControlBar(){this.editViewportIcon=this.controlBar.append("span").attr("class","icon-span").attr("data-toggle","tooltip").attr("data-placement","top").attr("title","Edit Chart").attr("id","edit-icon").append("i").attr("class","fas fa-edit icon").attr("data-toggle","modal").attr("data-target","#displayEditorModal").on("click",this.edit),this.exportViewportIcon=this.controlBar.append("span").attr("class","icon-span").attr("data-toggle","tooltip").attr("data-placement","top").attr("title","Download Chart").attr("id","download-icon").append("i").attr("class","fas fa-download icon").on("click",this.exportSVG),this.removeViewportIcon=this.controlBar.append("span").attr("class","icon-span").attr("data-toggle","tooltip").attr("data-placement","top").attr("title","Delete Chart").attr("id","trash-icon").append("i").attr("class","fas fa-trash icon").on("click",this.remove),$(function(){$("[data-toggle=\"tooltip\"]").tooltip({delay:{show:2000,hide:100}})})}removeControlBar(){$(function(){$("[data-toggle=\"tooltip\"]").tooltip("hide")}),this.controlBar.selectAll("span").remove()}edit(){$("#edit-icon").tooltip("hide"),clima.editor.open(clima.viewport.selection)}exportSVG(){$("#download-icon").tooltip("hide");var e=clima.viewport.selection.element.select("svg").node(),r=new XMLSerializer().serializeToString(e),o="clima_viewport_"+clima.viewport.selection.id+".svg",l=new Blob([r],{type:"text/plain"}),c=window.URL.createObjectURL(l),u=document.createElement("a");u.href=c,u.download=o,u.style.visibility="hidden",document.body.appendChild(u),u.click(),setTimeout(function(){document.body.removeChild(u),window.URL.revokeObjectURL(c)},0)}exportPNG(){alert("TODO: develop PNG downloader class")}exportCSV(){alert("TODO: develop CSV downloader class")}remove(){$("#trash-icon").tooltip("hide"),clima.viewport.selection.element.remove();for(var e=0;e<clima.viewports.length;e++)clima.viewports[e]===clima.viewport.selection&&clima.viewports.splice(e,1)}select(){this===clima.viewport.selection?this.deselect():(clima.viewport.selection&&clima.viewport.selection.deselect(),this.drawControlBar(),this.element.classed("viewport-select",!0),clima.viewport.selection=this)}deselect(){this.removeControlBar(),this.element.classed("viewport-select",!1),clima.viewport.selection=!1}static add(){clima.editor.open(!1)}}